{% extends "layout2.html" %}
{% block title %}Home{% endblock %}
{% block body %}
    <li><a class="dropdown-item" href="{{ url_for('usuario.perfil_route') }}">Perfil</a></li>
    <li><a class="dropdown-item" href="{{ url_for('usuario.organizador_route') }}">Modo Organizador</a></li>
    <li><a class="dropdown-item" href="{{ url_for('inscricoes.minhas_inscricoes') }}">Minhas Inscrições</a></li> 
{% endblock %}

{% block body2 %}
    {% if g.eventos_notificacao %}
    <div class="dropdown me-3 mt-2 mb-2" style="text-align: right;">
        <button class="btn btn-warning position-relative" type="button" id="notificacaoDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-bell-fill"></i> 
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                {{ g.eventos_notificacao|length }}
                <span class="visually-hidden">notificações não lidas</span>
            </span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificacaoDropdown">
            <li class="dropdown-header text-center">
                Você tem {{ g.eventos_notificacao|length }} evento(s) em breve
            </li>
            <li><hr class="dropdown-divider"></li>
            {% for evento in g.eventos_notificacao %}
            <li class="px-3 py-1">
                <strong>{{ evento.titulo }}</strong><br>
                <small>{{ evento.data_execucao.strftime('%d/%m/%Y') }}</small>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
{% endblock %}

{% block main %}
<br>
    
    <div class="container"> 
        <h3 class="mb-4">Eventos Salvos</h3>
        <div class="position-relative">
            <button id="prevBtn" class="btn btn-secondary position-absolute top-50 start-0 translate-middle-y" style="z-index:10;">‹</button>

            <div id="carouselFavoritos" class="d-flex flex-row flex-nowrap overflow-auto gap-4 px-2 scroll-smooth" style="scroll-behavior: smooth;">
                {% for item in favoritos %}
                    <div class="card flex-shrink-0" style="position: relative;">
                        <form method="post" action="{{ url_for('evento.toggle_favorito_route', id=item.id) }}"
                            class="position-absolute top-0 end-0 m-2" style="z-index: 5;">
                            <button type="submit" style="border: none; background: none; font-size: 1.5rem;">
                                {% if item in current_user.favoritos %}⭐{% else %}☆{% endif %}
                            </button>
                        </form>

                        <a href="{{ url_for('evento.visualizar_route', id=item.id) }}" class="text-decoration-none">
                            <img src="{{ url_for('static', filename=item.foto_evento_url if item.foto_evento_url else 'img/default_event.png') }}"
                                class="card-img-top" alt="Imagem do Evento">

                            <div class="card-body">
                                <div> <h5 class="card-title">{{ item.titulo }}</h5>
                                </div>

                                <div class="tags-placeholder"> 
                                    {% if item.tags %}
                                    <div class="actual-tags-content">
                                        <h5 class="fw-bold">Tags:</h5>
                                        <div class="d-flex flex-wrap gap-1 mt-1">
                                            {% for tag in item.tags %}
                                                <span class="badge tag-estilizada">#{{ tag.nome }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            </div>

            <button id="nextBtn" class="btn btn-secondary position-absolute top-50 end-0 translate-middle-y" style="z-index:10;">›</button>
        </div>
    </div> 
    <hr class="my-4">

    <div class="container">
        {% if termo %}
            <h2 class="mb-4">Resultados para "{{ termo }}"</h2>
        {% else %}
            <h2 class="mb-4">Eventos em Destaque</h2>
        {% endif %}
        <br>
        
        <div class="row row-cols-1 row-cols-md-3 g-4">
            {% if lista_eventos %}
                {% for item in lista_eventos %}
                    <div class="col evento-card" id="evento-{{ item.id }}">
                        <div class="card h-100 position-relative">
                            <form method="post" action="{{ url_for('evento.toggle_favorito_route', id=item.id) }}"
                                class="position-absolute top-0 end-0 m-2" style="z-index: 1;">
                                <button type="submit" style="border: none; background: none; font-size: 1.5rem;">
                                    {% if item in current_user.favoritos %}⭐{% else %}☆{% endif %}
                                </button>
                            </form>

                            <a href="{{ url_for('evento.visualizar_route', id=item.id) }}" class="text-decoration-none text-dark d-flex flex-column h-100">
                                <img src="{{ url_for('static', filename=item.foto_evento_url if item.foto_evento_url else 'img/default_event.png') }}" 
                                    class="card-img-top" alt="Imagem do Evento">

                                <div class="card-body d-flex flex-column">
                                    <div> <h5 class="card-title">{{ item.titulo }}</h5>
                                    </div>

                                    {% if item.tags %}
                                        <div class="mt-4"> 
                                            <h5 class="fw-bold">Tags:</h5> <div class="d-flex flex-wrap gap-2 mt-2"> {% for tag in item.tags %}
                                                    <span class="badge tag-estilizada">#{{ tag.nome }}</span> {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                    </div>
                            </a>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                {% if termo %}
                <p class="text-center col-12">Nenhum evento encontrado para "{{ termo }}".</p>
                {% else %}
                <p class="text-center col-12">Nenhum evento em destaque no momento.</p>
                {% endif %}
            {% endif %}
        </div>
    </div>
    <br>
{% endblock %}

